webpackJsonp([12],{12:function(e,a){"use strict";function t(e){$(e).iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue",disabledClass:"disabled"})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=t},21:function(e,a){"use strict";function t(e){var a={data:e.data||[],destroy:!0,dom:e.dom||'<"top"f>rt<"bottom"lip>',columns:e.columns||[],language:{sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 条结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 条结果，共 _TOTAL_ 条",sInfoEmpty:"显示第 0 至 0 条结果，共 0 条",sInfoFiltered:"(由 _MAX_ 条结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},paging:e.paging,pageLength:e.pageLength||10,columnDefs:e.columnDefs||"",order:e.order||[],createdRow:e.createdRow||null};e.scrollX&&(a.scrollX=e.scrollX);var t=$("#"+e.id).DataTable(a);return t}function r(e,a,t,r){$("#"+e+" tbody").off(a,t).on(a,t,r)}function d(e){var a=$("#"+e).DataTable().row($(this).parents("tr")).data();return a}Object.defineProperty(a,"__esModule",{value:!0}),a.default=t,a.bindTableEvent=r,a.getTableItem=d},510:function(e,a,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var d=t(5),l=r(d),i=t(18),n=r(i),s=t(24),o=r(s),u=t(6),c=r(u),p=t(3),m=r(p),f=t(4),v=r(f),h=t(8),g=r(h),b=t(7),y=r(b),N=t(2),x=(r(N),t(12)),T=r(x),_=t(21),w=r(_),q=t(10),k=t(144),R={},z="",H="",E='<select name="type" class="form-control"><option value="string">string</option><option value="long">long</option><option value="double">double</option><option value="date">date</option><option value="geo_point">geo_point</option><option value="nested">nested</option></select>',O='<select name="store" class="form-control"><option value="true">是</option><option value="false" selected>否</option></select>',A='<select name="index" class="form-control"><option value="true" selected>是</option><option value="false">否</option></select>',C='<select class="form-control" name="key"><option value="true">是</option><option value="false" selected>否</option></select>',I=(0,l.default)("option",{value:""},void 0,"请选择"),D=(0,l.default)("div",{className:"box-header with-border "},void 0,(0,l.default)("p",{className:"box-title"},void 0,"基本信息")),S=(0,l.default)("label",{htmlFor:"datasetName"},void 0,(0,l.default)("span",{className:"identify"},void 0,"* "),"名称 : "),F=(0,l.default)("span",{className:"messages"}),P=(0,l.default)("div",{name:"isPartition",className:"form-group col-md-3"},void 0,(0,l.default)("label",{htmlFor:"isPartition"},void 0,"是否分区 : "),(0,l.default)("div",{className:"radio"},void 0,(0,l.default)("label",{},void 0,(0,l.default)("input",{name:"isPartition",type:"radio",value:"true"})," 是"),(0,l.default)("label",{className:"ml20"},void 0,(0,l.default)("input",{name:"isPartition",type:"radio",value:"false",defaultChecked:!0})," 否"))),V=(0,l.default)("div",{name:"isVisible",className:"form-group col-md-3"},void 0,(0,l.default)("label",{htmlFor:"isVisible"},void 0,"可见性 : "),(0,l.default)("div",{className:"radio"},void 0,(0,l.default)("label",{},void 0,(0,l.default)("input",{name:"isVisible",type:"radio",value:"PUBLIC",defaultChecked:!0})," 共享"),(0,l.default)("label",{className:"ml20"},void 0,(0,l.default)("input",{name:"isVisible",type:"radio",value:"PRIVATE"})," 私有"))),J=(0,l.default)("label",{},void 0,(0,l.default)("span",{className:"identify"},void 0,"* "),"分片数 : "),L=(0,l.default)("span",{className:"messages"}),M=(0,l.default)("label",{},void 0,(0,l.default)("span",{className:"identify"},void 0,"* "),"副本数 : "),X=(0,l.default)("span",{className:"messages"}),B=(0,l.default)("div",{className:"box-header with-border "},void 0,(0,l.default)("p",{className:"box-title"},void 0,"字段")),G=(0,l.default)("thead",{},void 0,(0,l.default)("tr",{},void 0,(0,l.default)("th",{}),(0,l.default)("th",{},void 0,"字段名"),(0,l.default)("th",{},void 0,"字段描述"),(0,l.default)("th",{},void 0,"字段类型"),(0,l.default)("th",{},void 0,"存储"),(0,l.default)("th",{},void 0,"索引"),(0,l.default)("th",{},void 0,"分词"),(0,l.default)("th",{},void 0,"主键"),(0,l.default)("th",{},void 0,"操作"))),U=(0,l.default)("div",{className:"box-header with-border"},void 0,(0,l.default)("p",{className:"box-title"},void 0,"设置分区 ",(0,l.default)("small",{},void 0," （新建字段需包含 [date] 类型且字段名不为空）"))),j=(0,l.default)("label",{htmlFor:"partitionField"},void 0,"分区字段"),Z=(0,l.default)("span",{className:"messages"}),W=(0,l.default)("label",{htmlFor:"partitionRule"},void 0,"分区规则"),K=(0,l.default)("span",{className:"messages"}),Q=(0,l.default)("select",{id:"partitionRuleSelect",className:"form-control ml5 left"},void 0,(0,l.default)("option",{value:"d",selected:!0},void 0,"天"),(0,l.default)("option",{value:"w"},void 0,"周"),(0,l.default)("option",{value:"M"},void 0,"月"),(0,l.default)("option",{value:"y"},void 0,"年")),Y=(0,l.default)("i",{className:"fa fa-save"}),ee=function(e){function a(e){(0,m.default)(this,a);var t=(0,g.default)(this,(a.__proto__||(0,c.default)(a)).call(this,e));return t.isNameExistsHandler=t.isNameExistsHandler.bind(t),t.createDataSetHandler=t.createDataSetHandler.bind(t),t.changePartitionRangeHandler=t.changePartitionRangeHandler.bind(t),t.selectIndexHandler=t.selectIndexHandler.bind(t),t.selectTypeHandler=t.selectTypeHandler.bind(t),t.shardJudge=t.shardJudge.bind(t),t.replicationJudge=t.replicationJudge.bind(t),t.partitionRuleJudge=t.partitionRuleJudge.bind(t),t.validateHandler=t.validateHandler.bind(t),t.showPartitionRangeHandler=t.showPartitionRangeHandler.bind(t),t.partitionRuleHandler=t.partitionRuleHandler.bind(t),t.fieldInputHandler=t.fieldInputHandler.bind(t),t.focusVal=t.focusVal.bind(t),t}return(0,y.default)(a,e),(0,v.default)(a,[{key:"componentWillMount",value:function(){this.props.getMaxSettingNums(),this.props.listAnalyzers()}},{key:"componentDidMount",value:function(){R={},this.crateTableHandler(),(0,T.default)('input[ type = "radio"]');for(var e in this.props.dataset.dateFields)delete this.props.dataset.dateFields[e];$('div[name = "partitionArea"]').hide(),this.showPartitionRangeHandler()}},{key:"componentDidUpdate",value:function(){for(var e="",a=0;a<this.props.dataset.analyzers.length;a++)e+='<option value="'+this.props.dataset.analyzers[a]+'">'+this.props.dataset.analyzers[a]+"</option>";H='<select name="analyzer" class="form-control" id="analyzer">'+e+"</select>",$("#shard").val()||$("#shard").val(this.props.dataset.maxSettingNums.maxShardNum)}},{key:"showPartitionRangeHandler",value:function(){$('input[name="isPartition"]').on("ifChanged",function(){"true"==$(this).val()?$('div[name = "partitionArea"]').show():($("#partitionRule",$("#datasetAdd")).val(""),$('div[name = "partitionArea"]').hide())})}},{key:"changePartitionRangeHandler",value:function(e){var a=$(e.currentTarget).val();"date"===a?($('select[name = "dateRange"]').removeClass("hide"),$('span[name = "numRange"]').addClass("hide")):"number"===a&&($('select[name = "dateRange"]').addClass("hide"),$('span[name = "numRange"]').removeClass("hide"))}},{key:"crateTableHandler",value:function(){var e={};e.id="schema",e.columns=[{className:"textCenter",orderable:!1,data:null,defaultContent:""},{data:"fieldName",orderable:!1},{data:"name",orderable:!1},{data:"type",orderable:!1},{data:"store",orderable:!1},{data:"index",orderable:!1},{data:"analyzer",orderable:!1},{data:"key",orderable:!1},{className:"",orderable:!1,data:null,defaultContent:""}],e.dom='<"top">rt<"bottom"i>',e.scrollX=!1,e.paging=!1,e.createdRow=function(e,a,t){$("td:eq(0)",e).html("<span class='row-details row-details-close mt10 hide'></span><i class='fa fa-circle-thin mt10'></i>"),$("td:eq(8)",e).html("<i class='fa fa-trash-o' style='cursor: pointer;' title='删除'></i>")},e.data=[];var a=(0,w.default)(e);$("#schema").on("click","tbody td .fa-trash-o",function(){var e=$(this).parents("tr"),t=$(this).closest("tr").find("input.fieldName").val().trim(),r=a.row(e);r.remove(),a.draw(),"date"==$(this).closest("tr").find('select[name = "type"]').val()&&delete R[t];for(var d=[],l=0;l<$('select[name = "type"]').length;l++)d.push($('select[name = "type"]').eq(l).val());d.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)}),$("#schema").on("click","tbody td .row-details",function(){var e=this,t=$(this).parents("tr"),r=a.row(t);if(r.child.isShown()){for(var d=0;d<$("input.fieldName").length;d++){if($("input.fieldName").eq(d).val().length>30)return $("input.fieldName").eq(d).css("border","1px #dd4b39 solid"),void(0,q.error)("字段名最长为 30 个字符 !");if($("input.fieldName").eq(d).css("border","1px #d2d6de solid"),!/^(?!_)(?!.*?_$)/.test($("input.fieldName").eq(d).val()))return $("input.fieldName").eq(d).css("border","1px #dd4b39 solid"),void(0,q.error)("请检查字段名填写，下划线不能放在首尾 !");if($("input.fieldName").eq(d).css("border","1px #d2d6de solid"),!/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/.test($("input.fieldName").eq(d).val()))return $("input.fieldName").eq(d).css("border","1px #dd4b39 solid"),void(0,q.error)("请检查字段名填写，只能含有英文字母、数字和下划线 !");$("input.fieldName").eq(d).css("border","1px #d2d6de solid")}$(this).addClass("row-details-close").removeClass("row-details-open");for(var l=r.child().find("tbody tr"),i=[],s=0;s<$(l).length;s++){var u=$(l)[s];if(0!=$("input.fieldName",$(u)).length){var c={};c.fieldName=$("input.fieldName",$(u)).val(),c.name=$("input.name",$(u)).val();var p=$('select[name = "type"]',$(u)).val();c.type=p,c.store=$('select[name = "store"]',$(u)).val();var m=$('select[name = "index"]',$(u)).val(),f=$('select[name = "analyzer"]',$(u)).val();0!=$("input.fieldName",$(u)).length&&("false"==m?c.index="no":"string"!=p?c.index="not_analyzed":"string"==p&&"not_analyzed"==f?c.index="not_analyzed":"string"==p&&"not_analyzed"!=f&&(c.index="analyzed",c.analyzer=f)),c.key=$('select[name = "key"]',$(u)).val(),i.push(c)}}t.attr("schema",(0,o.default)(i)),r.child.hide()}else{var v=function(){if($(e).addClass("row-details-open").removeClass("row-details-close"),r.child())return r.child.show(),{v:void 0};r.child('<div id="nestRow_'+r.index()+'"><button type="submit" name="createNested" class="btn btn-sm btn-default mb5">\n                                <i class="fa fa-fw fa-plus-circle"></i>\n                                添加子字段\n                           </button>\n                           <table id="nestTable_'+r.index()+'"  class="table table-bordered" width="100%">\n                           <thead>\n                               <tr>\n                                   <th>子字段名</th>\n                                   <th>子字段描述</th>\n                                   <th>子字段类型</th>\n                                   <th>存储</th>\n                                   <th>索引</th>\n                                   <th>分词</th>\n                                   <th>主键</th>\n                                   <th>操作</th>\n                               </tr>\n                           </thead>\n                        </table></div>').show();var a={};a.id="nestTable_"+r.index(),a.columns=[{data:"fieldName",orderable:!1},{data:"name",orderable:!1},{data:"type",orderable:!1},{data:"store",orderable:!1},{data:"index",orderable:!1},{data:"analyzer",orderable:!1},{data:"key",orderable:!1},{className:"",orderable:!1,data:null,defaultContent:""}],a.createdRow=function(e,a,t){$("td:eq(7)",e).html("<i class='fa fa-trash-o' style='cursor: pointer;' title='删除'></i>")},a.paging=!1,a.dom='<"top">rt<"bottom"i>',a.scrollX=!1,a.data=[];var t=(0,w.default)(a);$("#nestTable_"+r.index()).on("click","tbody td .fa-trash-o",function(){var e=$(this).parents("tr"),a=t.row(e);a.remove(),t.draw();var r=$(this).closest("tr").find("input.fieldName").val().trim();"date"==$(this).closest("tr").find('select[name = "type"]').val()&&delete R[r];for(var d=[],l=0;l<$('select[name = "type"]').length;l++)d.push($('select[name = "type"]').eq(l).val());d.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)}),$('button[name = "createNested"]',$("#nestRow_"+r.index())).off("click").on("click",function(){var e=$("#nestTable_"+r.index()).DataTable();e.row.add({data:"",fieldName:'<input type="text" placeholder="支持英文、数字、下划线" maxlength= "30" class="fieldName form-control">',name:'<input type="text" class="name form-control">',type:'<select name="type" class="form-control"><option value="string">string</option><option value="long">long</option><option value="double">double</option><option value="date">date</option><option value="geo_point">geo_point</option></select>',store:'<select name="store" class="form-control"><option value="true">是</option><option value="false" selected>否</option></select>',index:'<select name="index" class="form-control"><option value="true">是</option><option value="false">否</option></select>',analyzer:H,key:'<select class="form-control"  name="key" id="key"><option value="true">是</option><option value="false" selected>否</option></select>'}).draw(),$("input.fieldName",$("#nestTable_"+r.index())).focus(function(e){""!=$(e.currentTarget).val().trim()&&(z=$(e.currentTarget).val().trim())}),$("input.fieldName",$("#nestTable_"+r.index())).blur(function(e){if(""!=$(e.currentTarget).val().trim())return $(e.currentTarget).val().length>=30?void $(e.currentTarget).css("border","1px #dd4b39 solid"):($(e.currentTarget).css("border","1px #d2d6de solid"),/^(?!_)(?!.*?_$)/.test($(e.currentTarget).val())?($(e.currentTarget).css("border","1px #d2d6de solid"),/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/.test($(e.currentTarget).val())?void $(e.currentTarget).css("border","1px #d2d6de solid"):void $(e.currentTarget).css("border","1px #dd4b39 solid")):void $(e.currentTarget).css("border","1px #dd4b39 solid"))}),$("input.fieldName",$("#nestTable_"+r.index())).change(function(e){var a=$(e.currentTarget).val().trim(),t=$(e.currentTarget).closest("tr").find('select[name="type"]').val(),d=[];return $("input.fieldName",$("#nestTable_"+r.index())).not($(e.currentTarget)).each(function(e,a){""!=$(a).val().trim()&&d.push($(a).val())}),d.indexOf(a)!=-1?($(e.currentTarget).css("border","1px #dd4b39 solid"),$(e.currentTarget).val(""),void $(e.currentTarget).focus()):($(e.currentTarget).css("border","1px #d2d6de solid"),$("input.fieldName",$("#nestTable_"+r.index())).each(function(){d.push($(this).val())}),""==a?void $(e.currentTarget).css("border","1px #dd4b39 solid"):void("date"==t?($(e.currentTarget).css("border","1px #d2d6de solid"),delete R[z],R[a]=a):$(e.currentTarget).css("border","1px #d2d6de solid")))}),$('select[name = "type"]',$("#nestTable_"+r.index())).change(function(){"string"===$(this).val()&&"true"==$(this).closest("tr").find('select[name = "index"]').val()?$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0);for(var e=$(this).val(),a=$(this).closest("tr").find("input.fieldName").val().trim(),t=[],r=0;r<$('select[name = "type"]').length;r++)t.push($('select[name = "type"]').eq(r).val());t.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0),"date"===e&&""!=a?R[a]=a:delete R[a]}),$('select[name = "index"]',$("#nestTable_"+r.index())).change(function(){"true"===$(this).val()&&"string"==$(this).closest("tr").find('select[name = "type"]').val()?$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(this).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0)})})}();if("object"===("undefined"==typeof v?"undefined":(0,n.default)(v)))return v.v}})}},{key:"isNameExistsHandler",value:function(){var e={datasetName:{presence:{message:"请输入数据集名"},format:{pattern:"^(?!_)(?!.*?_$)[a-z0-9_]+$",message:"请输入正确的数据集名"},length:{maximum:30,message:"不能超过30个字符"}}};(0,k.baseValidate)($(".datasetNameDiv"),e),""!=$("#datasetName",$("#datasetAdd")).val().trim()&&this.props.isExists($("#datasetName",$("#datasetAdd")).val())}},{key:"shardJudge",value:function(e){var a={shard:{presence:{message:"请输入分片数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,lessThanOrEqualTo:parseInt(e.target.max,10),notGreaterThanOrEqualTo:"最小值应大于等于 1",notLessThanOrEqualTo:"最大值应小于等于 "+e.target.max}}};(0,k.baseValidate)($(".shardJudgeDiv"),a)}},{key:"replicationJudge",value:function(e){var a={replication:{presence:{message:"请输入副本数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:0,lessThanOrEqualTo:parseInt(e.target.max,10),notGreaterThanOrEqualTo:"最小值为 0",notLessThanOrEqualTo:"最大值应小于等于 "+e.target.max}}};(0,k.baseValidate)($(".replicationJudgeDiv"),a)}},{key:"partitionRuleJudge",value:function(e){var a={partitionRule:{presence:"true"==$('input[name="isPartition"]:checked').val()&&{message:"请输入分区规则数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,notGreaterThanOrEqualTo:"最小值为 1",lessThanOrEqualTo:1024,notLessThanOrEqualTo:"最大值不能超过 1024"}}};(0,k.baseValidate)($("#partitionRuleDiv"),a)}},{key:"validateHandler",value:function(){var e={datasetName:{presence:{message:"请输入数据集名"},format:{pattern:"^(?!_)(?!.*?_$)[a-z0-9_]+$",message:"请输入正确的数据集名"}},shard:{presence:{message:"请输入分片数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,lessThanOrEqualTo:this.props.dataset.maxSettingNums.maxShardNum,notGreaterThanOrEqualTo:"最小值应大于等于 1",notLessThanOrEqualTo:"最大值应小于等于 "+this.props.dataset.maxSettingNums.maxShardNum}},replication:{presence:{message:"请输入副本数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:0,lessThanOrEqualTo:this.props.dataset.maxSettingNums.maxReplicationNum,notGreaterThanOrEqualTo:"最小值为 0",notLessThanOrEqualTo:"最大值为 "+this.props.dataset.maxSettingNums.maxReplicationNum}},partitionRule:{presence:"true"==$('input[name="isPartition"]:checked').val()&&{message:"请输入分区规则数"},numericality:{onlyInteger:!0,notInteger:"请输入整数",notValid:"请输入数字",greaterThanOrEqualTo:1,notGreaterThanOrEqualTo:"最小值为 1",lessThanOrEqualTo:1024,notLessThanOrEqualTo:"最大值不能超过 1024"}}};(0,k.baseValidate)($("#datasetAdd"),e)}},{key:"createDataSetHandler",value:function(){var e=this;if(""==$("#datasetName",$("#datasetAdd")).val().trim())return void(0,q.error)("请输入数据集名 !");if(this.props.dataset.isExists)return void(0,q.error)("数据集名已存在, 请重新输入 !");if(0==$("input.fieldName").length){if("true"==$('input[name = "isPartition"]:checked',$("#datasetAdd")).val())return void(0,q.error)("没有字段不能设置分区！")}else for(var a=0;a<$("input.fieldName").length;a++){if(""==$("input.fieldName").eq(a).val())return $("input.fieldName").eq(a).css("border","1px #dd4b39 solid"),void(0,q.error)("请输入字段名 （同级字段名不能重复） !");if($("input.fieldName").eq(a).css("border","1px #d2d6de solid"),$("input.fieldName").eq(a).val().length>30)return $("input.fieldName").eq(a).css("border","1px #dd4b39 solid"),void(0,q.error)("字段名最长为 30 个字符 !");if($("input.fieldName").eq(a).css("border","1px #d2d6de solid"),!/^(?!_)(?!.*?_$)/.test($("input.fieldName").eq(a).val()))return $("input.fieldName").eq(a).css("border","1px #dd4b39 solid"),void(0,q.error)("请检查字段名填写，下划线不能放在首尾 !");if($("input.fieldName").eq(a).css("border","1px #d2d6de solid"),!/^(?!_)(?!.*?_$)[a-zA-Z0-9_]+$/.test($("input.fieldName").eq(a).val()))return $("input.fieldName").eq(a).css("border","1px #dd4b39 solid"),void(0,q.error)("请检查字段名填写，只能含有英文字母、数字和下划线 !");$("input.fieldName").eq(a).css("border","1px #d2d6de solid")}if(this.validateHandler(),$("span.messages").find("p").length>0)return void(0,q.error)("输入异常，请检查后重新提交！");if("true"==$('input[name = "isPartition"]:checked',$("#datasetAdd")).val()&&""==$("#partitionField",$("#datasetAdd")).val())return void(0,q.error)("请选择分区字段！");var t={};if(t.datasetName=$("#datasetName",$("#datasetAdd")).val(),t.isPartition=$('input[name = "isPartition"]:checked',$("#datasetAdd")).val(),"true"==t.isPartition&&(t.partitionField=$("#partitionField",$("#datasetAdd")).val(),t.partitionRule=$("#partitionRule",$("#datasetAdd")).val()+$("#partitionRuleSelect",$("#datasetAdd")).val()),t.visable=$('input[name = "isVisible"]:checked',$("#datasetAdd")).val(),t.shard=$("#shard",$("#datasetAdd")).val(),t.replication=$("#replication",$("#datasetAdd")).val(),t.schema={},t.owner=sessionStorage.getItem("XDataUserName"),t.schema.properties=[],$("span.row-details-open",$("#schema")).click(),0!=$("input.fieldName",$("#schema")).length)for(var r=0;r<$("tbody tr",$("#schema")).length;r++){var d=$("tbody tr",$("#schema"))[r],l=$('select[name = "index"]',$(d)).val(),i=$('select[name = "type"]',$(d)).val(),n=$('select[name = "analyzer"]',$(d)).val(),s={};s.fieldName=$("input.fieldName",$(d)).val(),s.name=$("input.name",$(d)).val(),s.type=i,"nested"===i?s.schema=$(d).attr("schema")?JSON.parse($(d).attr("schema")):[]:(s.store=$('select[name = "store"]',$(d)).val(),s.key=$('select[name = "key"]',$(d)).val(),0!=$("input.fieldName",$(d)).length&&("false"==l?s.index="no":"string"!=i?s.index="not_analyzed":"string"==i&&"not_analyzed"==n?s.index="not_analyzed":"string"==i&&"not_analyzed"!=n&&(s.index="analyzed",s.analyzer=n))),t.schema.properties.push(s)}this.props.createDataset(t),"0"==this.props.dataset.code.code&&setTimeout(function(){e.props.history.replace("/dataSet")},500)}},{key:"handleCreateHandler",value:function(){var e=$("#schema").DataTable();e.row.add({data:"",fieldName:'<input type="text" placeholder="支持英文、数字、下划线" maxlength= "30" class="fieldName fieldNamer form-control">',name:'<input type="text" class="name form-control">',type:E,store:O,index:A,analyzer:H,key:C}).draw(),$("input.fieldName",$("#schema")).focus(this.focusVal),$("input.fieldName",$("#schema")).blur(this.fieldInputHandler),$('select[name = "type"]',$("#schema")).change(this.selectTypeHandler),$('select[name = "index"]',$("#schema")).change(this.selectIndexHandler)}},{key:"focusVal",value:function(e){""!=$(e.currentTarget).val().trim()&&(z=$(e.currentTarget).val().trim())}},{key:"fieldInputHandler",value:function(e){var a=$(e.currentTarget).val().trim(),t=$(e.currentTarget).closest("tr").find('select[name="type"]').val(),r=[];return $("input.fieldNamer").not($(e.currentTarget)).each(function(e,a){""!=$(a).val().trim()&&r.push($(a).val())}),r.indexOf(a)!=-1?($(e.currentTarget).css("border","1px #dd4b39 solid"),$(e.currentTarget).val(""),void $(e.currentTarget).focus()):($(e.currentTarget).css("border","1px #d2d6de solid"),""==a?($(e.currentTarget).css("border","1px #dd4b39 solid"),delete R[z],void this.props.setDateField(R)):void(/^(?!_)(?!.*?_$)/.test($(e.currentTarget).val())?"date"==t?($(e.currentTarget).css("border","1px #d2d6de solid"),delete R[z],R[a]=a,this.props.setDateField(R)):$(e.currentTarget).css("border","1px #d2d6de solid"):$(e.currentTarget).css("border","1px #dd4b39 solid")))}},{key:"selectIndexHandler",value:function(e){var a=$(e.currentTarget).val();"true"===a&&"string"==$(e.currentTarget).closest("tr").find('select[name = "type"]').val()?$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0)}},{key:"selectTypeHandler",value:function(e){var a=$(e.currentTarget).val(),t=$(e.currentTarget).closest("tr").find("input.fieldName").val().trim();if("nested"===a)$(e.currentTarget).closest("tr").find("span.row-details-close").click(),$("span.row-details",$(e.currentTarget).closest("tr")).removeClass("hide"),$("i.fa-circle-thin",$(e.currentTarget).closest("tr")).addClass("hide"),$(e.currentTarget).closest("tr").find('select[name = "store"]').prop("disabled",!0),$(e.currentTarget).closest("tr").find('select[name = "index"]').prop("disabled",!0),$(e.currentTarget).closest("tr").find('select[name = "key"]').prop("disabled",!0),$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0),delete R[t];else{var r=$("#schema").DataTable(),d=$(e.currentTarget).parents("tr"),l=r.row(d);l.child.isShown()&&($(e.currentTarget).closest("tr").find("span.row-details-open").addClass("row-details-close").removeClass("row-details-open"),l.child.hide()),$("span.row-details",$(e.currentTarget).closest("tr")).addClass("hide"),$("i.fa-circle-thin",$(e.currentTarget).closest("tr")).removeClass("hide"),$(e.currentTarget).closest("tr").find('select[name = "store"]').prop("disabled",!1),$(e.currentTarget).closest("tr").find('select[name = "index"]').prop("disabled",!1),$(e.currentTarget).closest("tr").find('select[name = "key"]').prop("disabled",!1),$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1),"date"===a&&""!=t?R[t]=t:delete R[t],"string"===a&&"true"==$(e.currentTarget).closest("tr").find('select[name = "index"]').val()?$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!1):$(e.currentTarget).closest("tr").find('select[name = "analyzer"]').prop("disabled",!0)}for(var i=[],n=0;n<$('select[name = "type"]').length;n++)i.push($('select[name = "type"]').eq(n).val());i.indexOf("date")!==-1?$("#partitionField").prop("disabled",!1):$("#partitionField").prop("disabled",!0)}},{key:"partitionRuleHandler",value:function(){for(var e=0;e<$('input[name="fieldName"]').length;e++){var a=$('input[name="fieldName"]').eq(e).val().trim(),t=$('input[name="fieldName"]').eq(e).closest("tr").find('select[name="type"]').val();if(""==a||"date"!=t)return!0;R[a]=a}this.props.setDateField(R)}},{key:"render",value:function(){var e=[I];for(var a in this.props.dataset.dateFields)e.push((0,l.default)("option",{value:a},void 0,this.props.dataset.dateFields[a]));return(0,l.default)("div",{id:"datasetAdd"},void 0,(0,l.default)("div",{className:"box box-primary"},void 0,D,(0,l.default)("div",{className:"box-body"},void 0,(0,l.default)("div",{className:"row"},void 0,(0,l.default)("div",{className:"datasetNameDiv col-md-6 form-group"},void 0,S,F,(0,l.default)("input",{type:"text",id:"datasetName",maxLength:30,name:"datasetName",className:"form-control",placeholder:"30个字符以内，只允许含有小写英文、数字和下划线且下划线不能放首尾",onBlur:this.isNameExistsHandler})),P,V),(0,l.default)("div",{className:"row"},void 0,(0,l.default)("div",{className:"shardJudgeDiv col-md-6 form-group"},void 0,J,L,(0,l.default)("input",{type:"text",name:"shard",id:"shard",min:"1",onBlur:this.shardJudge,max:this.props.dataset.maxSettingNums.maxShardNum,className:"form-control",placeholder:"1 <= 分片数 <= "+this.props.dataset.maxSettingNums.maxShardNum})),(0,l.default)("div",{className:"replicationJudgeDiv col-md-6 form-group"},void 0,M,X,(0,l.default)("input",{type:"text",name:"replication",id:"replication",onBlur:this.replicationJudge,min:"0",max:this.props.dataset.maxSettingNums.maxReplicationNum,defaultValue:1,className:"form-control",placeholder:"0 <= 副本数 <= "+this.props.dataset.maxSettingNums.maxReplicationNum}))))),(0,l.default)("div",{className:"box box-primary"},void 0,B,(0,l.default)("div",{className:"row box-body"},void 0,(0,l.default)("div",{className:"col-md-12"},void 0,(0,l.default)("div",{className:"box-header pull-left"},void 0,(0,l.default)("button",{type:"submit",name:"createDataset",className:"btn btn-primary",onClick:this.handleCreateHandler.bind(this)},void 0,(0,l.default)("i",{className:"fa fa-fw fa-plus-circle",style:{verticalAlign:"middle",padding:"0 8px 0 0"}}),"添加字段")),(0,l.default)("div",{className:"box-body"},void 0,(0,l.default)("table",{id:"schema",className:"table table-striped table-bordered",style:{width:"100%"}},void 0,G))))),(0,l.default)("div",{name:"partitionArea",id:"partitionArea",className:"box box-primary"},void 0,U,(0,l.default)("div",{className:"partition box-body"},void 0,(0,l.default)("div",{className:"partitionDetails row"},void 0,(0,l.default)("div",{className:"form-group col-md-6"},void 0,j,Z,(0,l.default)("select",{onMouseEnter:this.partitionRuleHandler,name:"partitionField",id:"partitionField",disabled:!0,className:"form-control",style:{width:"100%"}},void 0,e)),(0,l.default)("div",{className:"col-md-6 row"},void 0,(0,l.default)("div",{id:"partitionRuleDiv",className:"form-group col-md-6",style:{width:"86%"}},void 0,W,K,(0,l.default)("div",{},void 0,(0,l.default)("input",{type:"text",onBlur:this.partitionRuleJudge,id:"partitionRule",name:"partitionRule",min:"1",className:"distanceNum form-control left"}))),(0,l.default)("div",{className:"col-md-6",style:{width:"13%",marginTop:"25px"}},void 0,Q))))),(0,l.default)("button",{name:"saveBtn",className:"btn btn-primary",onClick:this.createDataSetHandler},void 0,Y," 保存"))}}]),a}(N.Component);a.default=ee}});